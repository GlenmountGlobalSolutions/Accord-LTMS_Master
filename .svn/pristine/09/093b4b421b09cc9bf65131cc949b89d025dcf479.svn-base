Imports System.Data.SqlClient

Public Class LotTraceData
    Inherits System.Web.UI.Page

    Protected datatable As New DataTable()


#Region "Event Handlers"

    Protected Sub Page_Load(ByVal sender As Object, ByVal e As System.EventArgs) Handles Me.Load
        Try

            If (Not IsPostBack) Then

                SetShipStatusAndDetailsPanelVisibility(False)

            End If

        Catch ex As Exception
            Master.eMsg(ex.ToString())
        End Try

    End Sub

    Private Sub LotTraceData_PreRender(sender As Object, e As System.EventArgs) Handles Me.PreRender
        EnableControls()
    End Sub

    Private Sub cmdView_Click(sender As Object, e As System.EventArgs) Handles cmdView.Click
        Try
            LoadShipStatusAndDetails()
        Catch ex As Exception
            Master.eMsg(ex.ToString())
        End Try
    End Sub

    Private Sub cmdModifyHistory_Click(sender As Object, e As System.EventArgs) Handles cmdModifyHistory.Click
        Try
            SaveModifiedProductHistory()
            LoadShipStatusAndDetails()

        Catch ex As Exception
            Master.eMsg(ex.ToString())
        End Try
    End Sub

    Private Sub dgHistory_ItemDataBound(sender As Object, e As System.Web.UI.WebControls.DataGridItemEventArgs) Handles dgHistory.ItemDataBound
        Dim i As Integer = 0
        Dim pSSN As String = ""
        Dim pStyleGroupID As String = ""
        Dim pProduct As String = ""
        Dim pOperationType As String = ""
        Dim pOperationName As String = ""
        Dim pRequirementData As String = ""
        Dim pOperationResult As String = ""
        Dim pStationID As String = ""
        Dim pAnchorText As String = ""

        Dim pTVR1 As String = "0"
        Dim pTVR2 As String = "0"
        Dim pTVR3 As String = "0"
        Dim pTVR4 As String = "0"
        Dim pTVR5 As String = "0"
        Dim pTVR6 As String = "0"
        Dim pTVR7 As String = "0"
        Dim pTVR8 As String = "0"
        Dim pTVR9 As String = "0"
        Dim pTVR10 As String = "0"
        Dim pTAR1 As String = "0"
        Dim pTAR2 As String = "0"
        Dim pTAR3 As String = "0"
        Dim pTAR4 As String = "0"
        Dim pTAR5 As String = "0"
        Dim pTAR6 As String = "0"
        Dim pTAR7 As String = "0"
        Dim pTAR8 As String = "0"
        Dim pTAR9 As String = "0"
        Dim pTAR10 As String = "0"


        Try
            If e.Item.ItemType = ListItemType.Item Or e.Item.ItemType = ListItemType.AlternatingItem Then

                'SSN = txtSSN.Text
                If e.Item.ItemIndex <> -1 Then

                    pSSN = CType(e.Item.DataItem, DataRowView).Row("SSN").ToString()
                    pStyleGroupID = CType(e.Item.DataItem, DataRowView).Row("StyleGroupID").ToString()
                    pProduct = CType(e.Item.DataItem, DataRowView).Row("Product").ToString()
                    pOperationType = CType(e.Item.DataItem, DataRowView).Row("OperationType").ToString()
                    pOperationName = CType(e.Item.DataItem, DataRowView).Row("OperationName").ToString()
                    pRequirementData = CType(e.Item.DataItem, DataRowView).Row("RequirementData").ToString()
                    pOperationResult = CType(e.Item.DataItem, DataRowView).Row("OperationResult").ToString()
                    pStationID = CType(e.Item.DataItem, DataRowView).Row("StationID").ToString()

                    'Populate Torque variables based on required data
                    If pRequirementData = "1" Then
                        pTVR1 = CType(e.Item.DataItem, DataRowView).Row("T1C1GTVR0").ToString()
                        pTVR2 = CType(e.Item.DataItem, DataRowView).Row("T1C1GTVR1").ToString()
                        pTVR3 = CType(e.Item.DataItem, DataRowView).Row("T1C1GTVR2").ToString()
                        pTVR4 = CType(e.Item.DataItem, DataRowView).Row("T1C1GTVR3").ToString()
                        pTVR5 = CType(e.Item.DataItem, DataRowView).Row("T1C1GTVR4").ToString()
                        pTVR6 = CType(e.Item.DataItem, DataRowView).Row("T1C1GTVR5").ToString()
                        pTVR7 = CType(e.Item.DataItem, DataRowView).Row("T1C1GTVR6").ToString()
                        pTVR8 = CType(e.Item.DataItem, DataRowView).Row("T1C1GTVR7").ToString()
                        pTVR9 = CType(e.Item.DataItem, DataRowView).Row("T1C1GTVR8").ToString()
                        pTVR10 = CType(e.Item.DataItem, DataRowView).Row("T1C1GTVR9").ToString()
                        pTAR1 = CType(e.Item.DataItem, DataRowView).Row("T1C1GTAR0").ToString()
                        pTAR2 = CType(e.Item.DataItem, DataRowView).Row("T1C1GTAR1").ToString()
                        pTAR3 = CType(e.Item.DataItem, DataRowView).Row("T1C1GTAR2").ToString()
                        pTAR4 = CType(e.Item.DataItem, DataRowView).Row("T1C1GTAR3").ToString()
                        pTAR5 = CType(e.Item.DataItem, DataRowView).Row("T1C1GTAR4").ToString()
                        pTAR6 = CType(e.Item.DataItem, DataRowView).Row("T1C1GTAR5").ToString()
                        pTAR7 = CType(e.Item.DataItem, DataRowView).Row("T1C1GTAR6").ToString()
                        pTAR8 = CType(e.Item.DataItem, DataRowView).Row("T1C1GTAR7").ToString()
                        pTAR9 = CType(e.Item.DataItem, DataRowView).Row("T1C1GTAR8").ToString()
                        pTAR10 = CType(e.Item.DataItem, DataRowView).Row("T1C1GTAR9").ToString()

                    ElseIf pRequirementData = "2" Then
                        pTVR1 = CType(e.Item.DataItem, DataRowView).Row("T1C2GTVR0").ToString()
                        pTVR2 = CType(e.Item.DataItem, DataRowView).Row("T1C2GTVR1").ToString()
                        pTVR3 = CType(e.Item.DataItem, DataRowView).Row("T1C2GTVR2").ToString()
                        pTVR4 = CType(e.Item.DataItem, DataRowView).Row("T1C2GTVR3").ToString()
                        pTVR5 = CType(e.Item.DataItem, DataRowView).Row("T1C2GTVR4").ToString()
                        pTVR6 = CType(e.Item.DataItem, DataRowView).Row("T1C2GTVR5").ToString()
                        pTVR7 = CType(e.Item.DataItem, DataRowView).Row("T1C2GTVR6").ToString()
                        pTVR8 = CType(e.Item.DataItem, DataRowView).Row("T1C2GTVR7").ToString()
                        pTVR9 = CType(e.Item.DataItem, DataRowView).Row("T1C2GTVR8").ToString()
                        pTVR10 = CType(e.Item.DataItem, DataRowView).Row("T1C2GTVR9").ToString()
                        pTAR1 = CType(e.Item.DataItem, DataRowView).Row("T1C2GTAR0").ToString()
                        pTAR2 = CType(e.Item.DataItem, DataRowView).Row("T1C2GTAR1").ToString()
                        pTAR3 = CType(e.Item.DataItem, DataRowView).Row("T1C2GTAR2").ToString()
                        pTAR4 = CType(e.Item.DataItem, DataRowView).Row("T1C2GTAR3").ToString()
                        pTAR5 = CType(e.Item.DataItem, DataRowView).Row("T1C2GTAR4").ToString()
                        pTAR6 = CType(e.Item.DataItem, DataRowView).Row("T1C2GTAR5").ToString()
                        pTAR7 = CType(e.Item.DataItem, DataRowView).Row("T1C2GTAR6").ToString()
                        pTAR8 = CType(e.Item.DataItem, DataRowView).Row("T1C2GTAR7").ToString()
                        pTAR9 = CType(e.Item.DataItem, DataRowView).Row("T1C2GTAR8").ToString()
                        pTAR10 = CType(e.Item.DataItem, DataRowView).Row("T1C2GTAR9").ToString()
                    ElseIf pRequirementData = "3" Then
                        pTVR1 = CType(e.Item.DataItem, DataRowView).Row("T1C3GTVR0").ToString()
                        pTVR2 = CType(e.Item.DataItem, DataRowView).Row("T1C3GTVR1").ToString()
                        pTVR3 = CType(e.Item.DataItem, DataRowView).Row("T1C3GTVR2").ToString()
                        pTVR4 = CType(e.Item.DataItem, DataRowView).Row("T1C3GTVR3").ToString()
                        pTVR5 = CType(e.Item.DataItem, DataRowView).Row("T1C3GTVR4").ToString()
                        pTVR6 = CType(e.Item.DataItem, DataRowView).Row("T1C3GTVR5").ToString()
                        pTVR7 = CType(e.Item.DataItem, DataRowView).Row("T1C3GTVR6").ToString()
                        pTVR8 = CType(e.Item.DataItem, DataRowView).Row("T1C3GTVR7").ToString()
                        pTVR9 = CType(e.Item.DataItem, DataRowView).Row("T1C3GTVR8").ToString()
                        pTVR10 = CType(e.Item.DataItem, DataRowView).Row("T1C3GTVR9").ToString()
                        pTAR1 = CType(e.Item.DataItem, DataRowView).Row("T1C3GTAR0").ToString()
                        pTAR2 = CType(e.Item.DataItem, DataRowView).Row("T1C3GTAR1").ToString()
                        pTAR3 = CType(e.Item.DataItem, DataRowView).Row("T1C3GTAR2").ToString()
                        pTAR4 = CType(e.Item.DataItem, DataRowView).Row("T1C3GTAR3").ToString()
                        pTAR5 = CType(e.Item.DataItem, DataRowView).Row("T1C3GTAR4").ToString()
                        pTAR6 = CType(e.Item.DataItem, DataRowView).Row("T1C3GTAR5").ToString()
                        pTAR7 = CType(e.Item.DataItem, DataRowView).Row("T1C3GTAR6").ToString()
                        pTAR8 = CType(e.Item.DataItem, DataRowView).Row("T1C3GTAR7").ToString()
                        pTAR9 = CType(e.Item.DataItem, DataRowView).Row("T1C3GTAR8").ToString()
                        pTAR10 = CType(e.Item.DataItem, DataRowView).Row("T1C3GTAR9").ToString()
                    ElseIf pRequirementData = "4" Then
                        pTVR1 = CType(e.Item.DataItem, DataRowView).Row("T1C4GTVR0").ToString()
                        pTVR2 = CType(e.Item.DataItem, DataRowView).Row("T1C4GTVR1").ToString()
                        pTVR3 = CType(e.Item.DataItem, DataRowView).Row("T1C4GTVR2").ToString()
                        pTVR4 = CType(e.Item.DataItem, DataRowView).Row("T1C4GTVR3").ToString()
                        pTVR5 = CType(e.Item.DataItem, DataRowView).Row("T1C4GTVR4").ToString()
                        pTVR6 = CType(e.Item.DataItem, DataRowView).Row("T1C4GTVR5").ToString()
                        pTVR7 = CType(e.Item.DataItem, DataRowView).Row("T1C4GTVR6").ToString()
                        pTVR8 = CType(e.Item.DataItem, DataRowView).Row("T1C4GTVR7").ToString()
                        pTVR9 = CType(e.Item.DataItem, DataRowView).Row("T1C4GTVR8").ToString()
                        pTVR10 = CType(e.Item.DataItem, DataRowView).Row("T1C4GTVR9").ToString()
                        pTAR1 = CType(e.Item.DataItem, DataRowView).Row("T1C4GTAR0").ToString()
                        pTAR2 = CType(e.Item.DataItem, DataRowView).Row("T1C4GTAR1").ToString()
                        pTAR3 = CType(e.Item.DataItem, DataRowView).Row("T1C4GTAR2").ToString()
                        pTAR4 = CType(e.Item.DataItem, DataRowView).Row("T1C4GTAR3").ToString()
                        pTAR5 = CType(e.Item.DataItem, DataRowView).Row("T1C4GTAR4").ToString()
                        pTAR6 = CType(e.Item.DataItem, DataRowView).Row("T1C4GTAR5").ToString()
                        pTAR7 = CType(e.Item.DataItem, DataRowView).Row("T1C4GTAR6").ToString()
                        pTAR8 = CType(e.Item.DataItem, DataRowView).Row("T1C4GTAR7").ToString()
                        pTAR9 = CType(e.Item.DataItem, DataRowView).Row("T1C4GTAR8").ToString()
                        pTAR10 = CType(e.Item.DataItem, DataRowView).Row("T1C4GTAR9").ToString()

                    ElseIf pRequirementData = "13" Then
                        pTVR1 = CType(e.Item.DataItem, DataRowView).Row("T2C1GTVR0").ToString()
                        pTVR2 = CType(e.Item.DataItem, DataRowView).Row("T2C1GTVR1").ToString()
                        pTVR3 = CType(e.Item.DataItem, DataRowView).Row("T2C1GTVR2").ToString()
                        pTVR4 = CType(e.Item.DataItem, DataRowView).Row("T2C1GTVR3").ToString()
                        pTVR5 = CType(e.Item.DataItem, DataRowView).Row("T2C1GTVR4").ToString()
                        pTVR6 = CType(e.Item.DataItem, DataRowView).Row("T2C1GTVR5").ToString()
                        pTVR7 = CType(e.Item.DataItem, DataRowView).Row("T2C1GTVR6").ToString()
                        pTVR8 = CType(e.Item.DataItem, DataRowView).Row("T2C1GTVR7").ToString()
                        pTVR9 = CType(e.Item.DataItem, DataRowView).Row("T2C1GTVR8").ToString()
                        pTVR10 = CType(e.Item.DataItem, DataRowView).Row("T2C1GTVR9").ToString()
                        pTAR1 = CType(e.Item.DataItem, DataRowView).Row("T2C1GTAR0").ToString()
                        pTAR2 = CType(e.Item.DataItem, DataRowView).Row("T2C1GTAR1").ToString()
                        pTAR3 = CType(e.Item.DataItem, DataRowView).Row("T2C1GTAR2").ToString()
                        pTAR4 = CType(e.Item.DataItem, DataRowView).Row("T2C1GTAR3").ToString()
                        pTAR5 = CType(e.Item.DataItem, DataRowView).Row("T2C1GTAR4").ToString()
                        pTAR6 = CType(e.Item.DataItem, DataRowView).Row("T2C1GTAR5").ToString()
                        pTAR7 = CType(e.Item.DataItem, DataRowView).Row("T2C1GTAR6").ToString()
                        pTAR8 = CType(e.Item.DataItem, DataRowView).Row("T2C1GTAR7").ToString()
                        pTAR9 = CType(e.Item.DataItem, DataRowView).Row("T2C1GTAR8").ToString()
                        pTAR10 = CType(e.Item.DataItem, DataRowView).Row("T2C1GTAR9").ToString()

                    ElseIf pRequirementData = "14" Then
                        pTVR1 = CType(e.Item.DataItem, DataRowView).Row("T2C2GTVR0").ToString()
                        pTVR2 = CType(e.Item.DataItem, DataRowView).Row("T2C2GTVR1").ToString()
                        pTVR3 = CType(e.Item.DataItem, DataRowView).Row("T2C2GTVR2").ToString()
                        pTVR4 = CType(e.Item.DataItem, DataRowView).Row("T2C2GTVR3").ToString()
                        pTVR5 = CType(e.Item.DataItem, DataRowView).Row("T2C2GTVR4").ToString()
                        pTVR6 = CType(e.Item.DataItem, DataRowView).Row("T2C2GTVR5").ToString()
                        pTVR7 = CType(e.Item.DataItem, DataRowView).Row("T2C2GTVR6").ToString()
                        pTVR8 = CType(e.Item.DataItem, DataRowView).Row("T2C2GTVR7").ToString()
                        pTVR9 = CType(e.Item.DataItem, DataRowView).Row("T2C2GTVR8").ToString()
                        pTVR10 = CType(e.Item.DataItem, DataRowView).Row("T2C2GTVR9").ToString()
                        pTAR1 = CType(e.Item.DataItem, DataRowView).Row("T2C2GTAR0").ToString()
                        pTAR2 = CType(e.Item.DataItem, DataRowView).Row("T2C2GTAR1").ToString()
                        pTAR3 = CType(e.Item.DataItem, DataRowView).Row("T2C2GTAR2").ToString()
                        pTAR4 = CType(e.Item.DataItem, DataRowView).Row("T2C2GTAR3").ToString()
                        pTAR5 = CType(e.Item.DataItem, DataRowView).Row("T2C2GTAR4").ToString()
                        pTAR6 = CType(e.Item.DataItem, DataRowView).Row("T2C2GTAR5").ToString()
                        pTAR7 = CType(e.Item.DataItem, DataRowView).Row("T2C2GTAR6").ToString()
                        pTAR8 = CType(e.Item.DataItem, DataRowView).Row("T2C2GTAR7").ToString()
                        pTAR9 = CType(e.Item.DataItem, DataRowView).Row("T2C2GTAR8").ToString()
                        pTAR10 = CType(e.Item.DataItem, DataRowView).Row("T2C2GTAR9").ToString()
                    ElseIf pRequirementData = "15" Then
                        pTVR1 = CType(e.Item.DataItem, DataRowView).Row("T2C3GTVR0").ToString()
                        pTVR2 = CType(e.Item.DataItem, DataRowView).Row("T2C3GTVR1").ToString()
                        pTVR3 = CType(e.Item.DataItem, DataRowView).Row("T2C3GTVR2").ToString()
                        pTVR4 = CType(e.Item.DataItem, DataRowView).Row("T2C3GTVR3").ToString()
                        pTVR5 = CType(e.Item.DataItem, DataRowView).Row("T2C3GTVR4").ToString()
                        pTVR6 = CType(e.Item.DataItem, DataRowView).Row("T2C3GTVR5").ToString()
                        pTVR7 = CType(e.Item.DataItem, DataRowView).Row("T2C3GTVR6").ToString()
                        pTVR8 = CType(e.Item.DataItem, DataRowView).Row("T2C3GTVR7").ToString()
                        pTVR9 = CType(e.Item.DataItem, DataRowView).Row("T2C3GTVR8").ToString()
                        pTVR10 = CType(e.Item.DataItem, DataRowView).Row("T2C3GTVR9").ToString()
                        pTAR1 = CType(e.Item.DataItem, DataRowView).Row("T2C3GTAR0").ToString()
                        pTAR2 = CType(e.Item.DataItem, DataRowView).Row("T2C3GTAR1").ToString()
                        pTAR3 = CType(e.Item.DataItem, DataRowView).Row("T2C3GTAR2").ToString()
                        pTAR4 = CType(e.Item.DataItem, DataRowView).Row("T2C3GTAR3").ToString()
                        pTAR5 = CType(e.Item.DataItem, DataRowView).Row("T2C3GTAR4").ToString()
                        pTAR6 = CType(e.Item.DataItem, DataRowView).Row("T2C3GTAR5").ToString()
                        pTAR7 = CType(e.Item.DataItem, DataRowView).Row("T2C3GTAR6").ToString()
                        pTAR8 = CType(e.Item.DataItem, DataRowView).Row("T2C3GTAR7").ToString()
                        pTAR9 = CType(e.Item.DataItem, DataRowView).Row("T2C3GTAR8").ToString()
                        pTAR10 = CType(e.Item.DataItem, DataRowView).Row("T2C3GTAR9").ToString()
                    ElseIf pRequirementData = "16" Then
                        pTVR1 = CType(e.Item.DataItem, DataRowView).Row("T2C4GTVR0").ToString()
                        pTVR2 = CType(e.Item.DataItem, DataRowView).Row("T2C4GTVR1").ToString()
                        pTVR3 = CType(e.Item.DataItem, DataRowView).Row("T2C4GTVR2").ToString()
                        pTVR4 = CType(e.Item.DataItem, DataRowView).Row("T2C4GTVR3").ToString()
                        pTVR5 = CType(e.Item.DataItem, DataRowView).Row("T2C4GTVR4").ToString()
                        pTVR6 = CType(e.Item.DataItem, DataRowView).Row("T2C4GTVR5").ToString()
                        pTVR7 = CType(e.Item.DataItem, DataRowView).Row("T2C4GTVR6").ToString()
                        pTVR8 = CType(e.Item.DataItem, DataRowView).Row("T2C4GTVR7").ToString()
                        pTVR9 = CType(e.Item.DataItem, DataRowView).Row("T2C4GTVR8").ToString()
                        pTVR10 = CType(e.Item.DataItem, DataRowView).Row("T2C4GTVR9").ToString()
                        pTAR1 = CType(e.Item.DataItem, DataRowView).Row("T2C4GTAR0").ToString()
                        pTAR2 = CType(e.Item.DataItem, DataRowView).Row("T2C4GTAR1").ToString()
                        pTAR3 = CType(e.Item.DataItem, DataRowView).Row("T2C4GTAR2").ToString()
                        pTAR4 = CType(e.Item.DataItem, DataRowView).Row("T2C4GTAR3").ToString()
                        pTAR5 = CType(e.Item.DataItem, DataRowView).Row("T2C4GTAR4").ToString()
                        pTAR6 = CType(e.Item.DataItem, DataRowView).Row("T2C4GTAR5").ToString()
                        pTAR7 = CType(e.Item.DataItem, DataRowView).Row("T2C4GTAR6").ToString()
                        pTAR8 = CType(e.Item.DataItem, DataRowView).Row("T2C4GTAR7").ToString()
                        pTAR9 = CType(e.Item.DataItem, DataRowView).Row("T2C4GTAR8").ToString()
                        pTAR10 = CType(e.Item.DataItem, DataRowView).Row("T2C4GTAR9").ToString()
                    End If


                    'Create lotAnchor string
                    pAnchorText = "<a id='lotAnchor_" & i & "' href='#' data-SSN='" & pSSN & _
                        "' data-StyleGroupID='" & pStyleGroupID & _
                        "' data-Product='" & pProduct & _
                        "' data-OperationType='" & pOperationType & _
                        "' data-OperationName='" & pOperationName & _
                        "' data-RequirementData='" & pRequirementData & _
                        "' data-OperationResult='" & pOperationResult & _
                        "' data-StationID='" & pStationID & _
                        "' data-Torque1='" & pTVR1 & _
                        "' data-Torque2='" & pTVR2 & _
                        "' data-Torque3='" & pTVR3 & _
                        "' data-Torque4='" & pTVR4 & _
                        "' data-Torque5='" & pTVR5 & _
                        "' data-Torque6='" & pTVR6 & _
                        "' data-Torque7='" & pTVR7 & _
                        "' data-Torque8='" & pTVR8 & _
                        "' data-Torque9='" & pTVR9 & _
                        "' data-Torque10='" & pTVR10 & _
                        "' data-Angle1='" & pTAR1 & _
                        "' data-Angle2='" & pTAR2 & _
                        "' data-Angle3='" & pTAR3 & _
                        "' data-Angle4='" & pTAR4 & _
                        "' data-Angle5='" & pTAR5 & _
                        "' data-Angle6='" & pTAR6 & _
                        "' data-Angle7='" & pTAR7 & _
                        "' data-Angle8='" & pTAR8 & _
                        "' data-Angle9='" & pTAR9 & _
                        "' data-Angle10='" & pTAR10 & _
                        "'>" & pOperationType & "</a>"

                    'Cell(3) determines the link will be on the fourth column of the datagrid 
                    e.Item.Cells(3).Text = pAnchorText

                    i = i + 1

                End If

                If (CType(e.Item.DataItem, DataRowView).Row("OperationResult").ToString().ToUpper = "FAIL") Or (CType(e.Item.DataItem, DataRowView).Row("OperationResult").ToString().ToUpper = "NOT FOUND") Then
                    e.Item.Cells(6).CssClass = "ui-state-error-text"
                End If
            End If

        Catch ex As Exception
            Master.eMsg(ex.ToString())
        End Try
    End Sub

#End Region

#Region "Methods"

    Private Sub EnableControls()
        Master.Secure(cmdView)
    End Sub

    Private Sub LoadShipStatusAndDetails()
        Dim strError As String = ""
        Try

            If (GetSubReport(txtSSN.Text, strError) = True) Then

                GetSSNDetails(txtSSN.Text)

                SetShipStatusAndDetailsPanelVisibility(True)

                lblMessage.Text = ""
            Else
                SetShipStatusAndDetailsPanelVisibility(False)

                lblMessage.Text = strError
            End If

        Catch ex As Exception
            Master.eMsg(ex.ToString())
        End Try
    End Sub

    Public Function GetSubReport(ByRef strSSN As String, ByRef strErr As String) As Boolean
        Dim colParms As New List(Of SqlParameter)
        Dim prmNext As Data.SqlClient.SqlParameter
        Dim ds As DataSet
        Dim bResult As Boolean = False
        Dim strOperationID As String = ""
        Dim strDescription As String = ""
        Dim i As Integer
        Dim colOutParms As List(Of SqlParameter)
        Dim pintReturn As Integer = 0

        Try
            dgHistory.DataSource = Nothing
            dgHistory.DataBind()

            prmNext = New Data.SqlClient.SqlParameter("@SerialNumber", SqlDbType.VarChar, 32)
            prmNext.Value = strSSN.ToUpper
            colParms.Add(prmNext)
            ds = DA.GetDataSet("procSGGetProductRequirements", colParms)
            colParms.Clear()

            If (ds.Tables.Count = 0 OrElse ds.Tables(0).Rows.Count = 0) Then
                bResult = False
                strErr = "Error: Please enter valid serial number!"
            Else
                dgHistory.DataSource = ds
                dgHistory.DataBind()

                bResult = True

            End If


            'Get Status
            prmNext = New Data.SqlClient.SqlParameter("@SSN", SqlDbType.VarChar, 16)
            prmNext.Value = strSSN
            colParms.Add(prmNext)
            prmNext = New Data.SqlClient.SqlParameter("@ReturnCode", SqlDbType.Int)
            prmNext.Direction = ParameterDirection.Output
            colParms.Add(prmNext)
            colOutParms = DA.ExecSP("procSGVerifySSN_Single", colParms)
            colParms.Clear()

            For Each oParameter In colOutParms
                With oParameter
                    If .Direction = ParameterDirection.Output Then
                        Select Case .ParameterName
                            Case "@ReturnCode"
                                pintReturn = CType(oParameter.Value.ToString(), Integer)
                        End Select
                    End If
                End With
            Next

            colOutParms.Clear()

            If pintReturn = 1 Then
                lblShipStatus.Text = "<span class='fontGreen' >OK</span>"
            Else

                lblShipStatus.Text = "<span class='fontRed' >NOT OK</span>"

                For i = 0 To dgHistory.Items.Count - 1
                    If dgHistory.Items(i).Cells(6).Text.ToUpper = "NOT FOUND" Then
                        lblShipStatus.Text = "<span class='fontRed' >Lot Trace Data Missing! </span>"
                        Exit For
                    ElseIf dgHistory.Items(i).Cells(6).Text.ToUpper = "FAIL" Then
                        lblShipStatus.Text = "<span class='fontRed' >NOT OK</span>"
                    End If
                Next
            End If

        Catch ex As Exception
            Master.eMsg(ex.ToString())
        End Try

        Return bResult

    End Function

    Private Sub GetSSNDetails(strSSN As String)
        Dim colParms As New List(Of SqlParameter)
        Dim colOutParms As List(Of SqlParameter)
        Dim prmNext As Data.SqlClient.SqlParameter

        Try

            'IN--------------------------------------------------------
            prmNext = New Data.SqlClient.SqlParameter("@Data", SqlDbType.VarChar, 48)
            prmNext.Direction = ParameterDirection.Input
            prmNext.Value = strSSN
            colParms.Add(prmNext)
            'OUT--------------------------------------------------------
            prmNext = New Data.SqlClient.SqlParameter("@SSN", SqlDbType.VarChar, 80)
            prmNext.Direction = ParameterDirection.Output
            colParms.Add(prmNext)
            'OUT--------------------------------------------------------
            prmNext = New Data.SqlClient.SqlParameter("@CSN", SqlDbType.VarChar, 80)
            prmNext.Direction = ParameterDirection.Output
            colParms.Add(prmNext)
            'OUT--------------------------------------------------------
            prmNext = New Data.SqlClient.SqlParameter("@IBC", SqlDbType.VarChar, 80)
            prmNext.Direction = ParameterDirection.Output
            colParms.Add(prmNext)
            'OUT--------------------------------------------------------
            prmNext = New Data.SqlClient.SqlParameter("@ProdIDStatus", SqlDbType.VarChar, 80)
            prmNext.Direction = ParameterDirection.Output
            colParms.Add(prmNext)
            'OUT--------------------------------------------------------
            prmNext = New Data.SqlClient.SqlParameter("@SeatType", SqlDbType.VarChar, 80)
            prmNext.Direction = ParameterDirection.Output
            colParms.Add(prmNext)
            'OUT--------------------------------------------------------
            prmNext = New Data.SqlClient.SqlParameter("@SeatDesc", SqlDbType.VarChar, 80)
            prmNext.Direction = ParameterDirection.Output
            colParms.Add(prmNext)
            'OUT--------------------------------------------------------
            prmNext = New Data.SqlClient.SqlParameter("@SeatStyle", SqlDbType.VarChar, 80)
            prmNext.Direction = ParameterDirection.Output
            colParms.Add(prmNext)
            'OUT--------------------------------------------------------
            prmNext = New Data.SqlClient.SqlParameter("@ColorDesc", SqlDbType.VarChar, 80)
            prmNext.Direction = ParameterDirection.Output
            colParms.Add(prmNext)

            'OUT--------------------------------------------------------
            colOutParms = DA.ExecSP("procGetProductDetails", colParms)

            For Each oParameter In colOutParms
                With oParameter
                    If .Direction = ParameterDirection.Output Then

                        Select Case .ParameterName
                            
                            Case "@SSN"
                                lblSSN.Text = oParameter.Value.ToString()

                            Case "@IBC"
                                lblProductID.Text = oParameter.Value.ToString()

                            Case "@SeatType"
                                lblSeatType.Text = oParameter.Value.ToString()

                            Case "@SeatDesc"
                                lblSeatDesc.Text = oParameter.Value.ToString()

                            Case "@SeatStyle"
                                lblSeatStyle.Text = oParameter.Value.ToString()

                            Case "@ColorDesc"
                                lblColorDesc.Text = oParameter.Value.ToString()
                        End Select

                    End If
                End With
            Next

            lblSSN.Text = strSSN

        Catch ex As Exception
            Master.eMsg(ex.ToString())
        End Try
    End Sub

    Private Sub SaveModifiedProductHistory()
        Dim colParms As New List(Of SqlParameter)
        Dim prmNext As Data.SqlClient.SqlParameter

        Try

            'Ensure user did not clear initialized fields
            If hidOperationType.Value.ToUpper = "TORQUE" And txtTorque1.Text = "0" Then
                Master.eMsg("At Least 1 Torque Must Be Entered.")
                Exit Sub
            End If
            If txtTorque2.Text = "" Then
                txtTorque2.Text = "0"
            End If
            If txtTorque3.Text = "" Then
                txtTorque3.Text = "0"
            End If
            If txtTorque4.Text = "" Then
                txtTorque4.Text = "0"
            End If
            If txtTorque5.Text = "" Then
                txtTorque5.Text = "0"
            End If
            If txtTorque6.Text = "" Then
                txtTorque6.Text = "0"
            End If
            If txtTorque7.Text = "" Then
                txtTorque7.Text = "0"
            End If
            If txtTorque8.Text = "" Then
                txtTorque8.Text = "0"
            End If
            If txtTorque9.Text = "" Then
                txtTorque9.Text = "0"
            End If
            If txtTorque10.Text = "" Then
                txtTorque10.Text = "0"
            End If

            If txtAngle1.Text = "" Then
                txtAngle1.Text = "0"
            End If
            If txtAngle2.Text = "" Then
                txtAngle2.Text = "0"
            End If
            If txtAngle3.Text = "" Then
                txtAngle3.Text = "0"
            End If
            If txtAngle4.Text = "" Then
                txtAngle4.Text = "0"
            End If
            If txtAngle5.Text = "" Then
                txtAngle5.Text = "0"
            End If
            If txtAngle6.Text = "" Then
                txtAngle6.Text = "0"
            End If
            If txtAngle7.Text = "" Then
                txtAngle7.Text = "0"
            End If
            If txtAngle8.Text = "" Then
                txtAngle8.Text = "0"
            End If
            If txtAngle9.Text = "" Then
                txtAngle9.Text = "0"
            End If
            If txtAngle10.Text = "" Then
                txtAngle10.Text = "0"
            End If
            

            prmNext = New Data.SqlClient.SqlParameter("@SerialNumber", SqlDbType.VarChar, 32)
            prmNext.Direction = ParameterDirection.Input
            prmNext.Value = txtSSN.Text.ToUpper
            colParms.Add(prmNext)
            '---------------------------------------
            prmNext = New Data.SqlClient.SqlParameter("@StationID", SqlDbType.VarChar, 4)
            prmNext.Direction = ParameterDirection.Input
            prmNext.Value = hidStationID.Value
            colParms.Add(prmNext)
            '---------------------------------------
            prmNext = New Data.SqlClient.SqlParameter("@StyleGroupID", SqlDbType.Int)
            prmNext.Direction = ParameterDirection.Input
            prmNext.Value = hidStyleGroupID.Value
            colParms.Add(prmNext)
            '---------------------------------------
            prmNext = New Data.SqlClient.SqlParameter("@OperationType", SqlDbType.VarChar, 50)
            prmNext.Direction = ParameterDirection.Input
            prmNext.Value = hidOperationType.Value
            colParms.Add(prmNext)
            '---------------------------------------
            prmNext = New Data.SqlClient.SqlParameter("@OperationName", SqlDbType.VarChar, 80)
            prmNext.Direction = ParameterDirection.Input
            prmNext.Value = hidOperationName.Value
            colParms.Add(prmNext)
            '---------------------------------------
            prmNext = New Data.SqlClient.SqlParameter("@RequirementData", SqlDbType.VarChar, 50)
            prmNext.Direction = ParameterDirection.Input
            prmNext.Value = hidRequirementData.Value
            colParms.Add(prmNext)
            '---------------------------------------
            prmNext = New Data.SqlClient.SqlParameter("@sData1", SqlDbType.VarChar, 82)
            prmNext.Direction = ParameterDirection.Input
            prmNext.Value = txtBarCode.Text.ToUpper
            colParms.Add(prmNext)
            '---------------------------------------
            prmNext = New Data.SqlClient.SqlParameter("@rData1", SqlDbType.Real)
            prmNext.Direction = ParameterDirection.Input
            prmNext.Value = txtTorque1.Text
            colParms.Add(prmNext)
            '---------------------------------------
            prmNext = New Data.SqlClient.SqlParameter("@rData2", SqlDbType.Real)
            prmNext.Direction = ParameterDirection.Input
            prmNext.Value = txtTorque2.Text
            colParms.Add(prmNext)
            '---------------------------------------
            prmNext = New Data.SqlClient.SqlParameter("@rData3", SqlDbType.Real)
            prmNext.Direction = ParameterDirection.Input
            prmNext.Value = txtTorque3.Text
            colParms.Add(prmNext)
            '---------------------------------------
            prmNext = New Data.SqlClient.SqlParameter("@rData4", SqlDbType.Real)
            prmNext.Direction = ParameterDirection.Input
            prmNext.Value = txtTorque4.Text
            colParms.Add(prmNext)
            '---------------------------------------
            prmNext = New Data.SqlClient.SqlParameter("@rData5", SqlDbType.Real)
            prmNext.Direction = ParameterDirection.Input
            prmNext.Value = txtTorque5.Text
            colParms.Add(prmNext)
            '---------------------------------------
            prmNext = New Data.SqlClient.SqlParameter("@rData6", SqlDbType.Real)
            prmNext.Direction = ParameterDirection.Input
            prmNext.Value = txtTorque6.Text
            colParms.Add(prmNext)
            '---------------------------------------
            prmNext = New Data.SqlClient.SqlParameter("@rData7", SqlDbType.Real)
            prmNext.Direction = ParameterDirection.Input
            prmNext.Value = txtTorque7.Text
            colParms.Add(prmNext)
            '---------------------------------------
            prmNext = New Data.SqlClient.SqlParameter("@rData8", SqlDbType.Real)
            prmNext.Direction = ParameterDirection.Input
            prmNext.Value = txtTorque8.Text
            colParms.Add(prmNext)
            '---------------------------------------
            prmNext = New Data.SqlClient.SqlParameter("@rData9", SqlDbType.Real)
            prmNext.Direction = ParameterDirection.Input
            prmNext.Value = txtTorque9.Text
            colParms.Add(prmNext)
            '---------------------------------------
            prmNext = New Data.SqlClient.SqlParameter("@rData10", SqlDbType.Real)
            prmNext.Direction = ParameterDirection.Input
            prmNext.Value = txtTorque10.Text
            colParms.Add(prmNext)
            '---------------------------------------
            prmNext = New Data.SqlClient.SqlParameter("@rData11", SqlDbType.Real)
            prmNext.Direction = ParameterDirection.Input
            prmNext.Value = txtAngle1.Text
            colParms.Add(prmNext)
            '---------------------------------------
            prmNext = New Data.SqlClient.SqlParameter("@rData12", SqlDbType.Real)
            prmNext.Direction = ParameterDirection.Input
            prmNext.Value = txtAngle2.Text
            colParms.Add(prmNext)
            '---------------------------------------
            prmNext = New Data.SqlClient.SqlParameter("@rData13", SqlDbType.Real)
            prmNext.Direction = ParameterDirection.Input
            prmNext.Value = txtAngle3.Text
            colParms.Add(prmNext)
            '---------------------------------------
            prmNext = New Data.SqlClient.SqlParameter("@rData14", SqlDbType.Real)
            prmNext.Direction = ParameterDirection.Input
            prmNext.Value = txtAngle4.Text
            colParms.Add(prmNext)
            '---------------------------------------
            prmNext = New Data.SqlClient.SqlParameter("@rData15", SqlDbType.Real)
            prmNext.Direction = ParameterDirection.Input
            prmNext.Value = txtAngle5.Text
            colParms.Add(prmNext)
            '---------------------------------------
            prmNext = New Data.SqlClient.SqlParameter("@rData16", SqlDbType.Real)
            prmNext.Direction = ParameterDirection.Input
            prmNext.Value = txtAngle6.Text
            colParms.Add(prmNext)
            '---------------------------------------
            prmNext = New Data.SqlClient.SqlParameter("@rData17", SqlDbType.Real)
            prmNext.Direction = ParameterDirection.Input
            prmNext.Value = txtAngle7.Text
            colParms.Add(prmNext)
            '---------------------------------------
            prmNext = New Data.SqlClient.SqlParameter("@rData18", SqlDbType.Real)
            prmNext.Direction = ParameterDirection.Input
            prmNext.Value = txtAngle8.Text
            colParms.Add(prmNext)
            '---------------------------------------
            prmNext = New Data.SqlClient.SqlParameter("@rData19", SqlDbType.Real)
            prmNext.Direction = ParameterDirection.Input
            prmNext.Value = txtAngle9.Text
            colParms.Add(prmNext)
            '---------------------------------------
            prmNext = New Data.SqlClient.SqlParameter("@rData20", SqlDbType.Real)
            prmNext.Direction = ParameterDirection.Input
            prmNext.Value = txtAngle10.Text
            colParms.Add(prmNext)
            '---------------------------------------
            prmNext = New Data.SqlClient.SqlParameter("@EditedBy", SqlDbType.VarChar, 82)
            prmNext.Direction = ParameterDirection.Input
            prmNext.Value = Session("UserName")
            colParms.Add(prmNext)

            DA.ExecSP("procSGManualInsertLineData", colParms)


            'CLEAR ENTRIES
            txtBarCode.Text = ""

            txtTorque1.Text = "0"
            txtTorque2.Text = "0"
            txtTorque3.Text = "0"
            txtTorque4.Text = "0"
            txtTorque5.Text = "0"
            txtTorque6.Text = "0"
            txtTorque7.Text = "0"
            txtTorque8.Text = "0"
            txtTorque9.Text = "0"
            txtTorque10.Text = "0"

            txtAngle1.Text = "0"
            txtAngle2.Text = "0"
            txtAngle3.Text = "0"
            txtAngle4.Text = "0"
            txtAngle5.Text = "0"
            txtAngle6.Text = "0"
            txtAngle7.Text = "0"
            txtAngle8.Text = "0"
            txtAngle9.Text = "0"
            txtAngle10.Text = "0"

        Catch ex As Exception
            Master.eMsg(ex.ToString())
        End Try
    End Sub

    Private Sub SetShipStatusAndDetailsPanelVisibility(bVisible As Boolean)
        Try
            pnlShipStatus.Visible = bVisible
            pnlSSNDetails.Visible = bVisible
            pnlSSNReport.Visible = bVisible

        Catch ex As Exception
            Master.eMsg(ex.ToString())
        End Try
    End Sub

#End Region

End Class